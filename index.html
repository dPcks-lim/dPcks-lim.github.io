<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…ì¼ì–´ í†µí•© í•™ìŠµ ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        /* --- íƒìƒ‰ê¸° ìŠ¤íƒ€ì¼ --- */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        .vocab-card {
            border-top-width: 4px;
            transition: all 0.3s ease;
        }
        
        .card-der { border-color: #3B82F6; }
        .card-die { border-color: #EF4444; }
        .card-das { border-color: #10B981; }
        .card-multi { border-color: #A855F7; }

        .filter-btn.active {
            background-color: #3B82F6;
            color: white;
            border-color: #3B82F6;
            font-weight: 600;
        }

        /* --- ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ --- */
        .nav-btn {
            padding: 0.5rem 1.5rem;
            font-medium: 500;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            width: 50%;
            text-align: center;
            cursor: pointer;
        }
        .nav-btn.active {
            background-color: #3B82F6;
            color: white;
            font-weight: 600;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .nav-btn:not(.active):hover {
            background-color: #F3F4F6;
        }
        
        /* --- í€´ì¦ˆ ìŠ¤íƒ€ì¼ --- */
        .feedback {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            margin-top: 1rem;
        }
        .feedback-correct {
            background-color: #D1FAE5;
            color: #065F46;
            border: 1px solid #6EE7B7;
        }
        .feedback-incorrect {
            background-color: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
        }
        .feedback-hint {
            background-color: #FEF3C7;
            color: #92400E;
            border: 1px solid #FCD34D;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .btn {
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: #3B82F6;
            color: white;
            border-color: #3B82F6;
        }
        .btn-primary:hover {
            background-color: #2563EB;
        }
        .btn-secondary {
            background-color: #6B7280;
            color: white;
            border-color: #6B7280;
        }
        .btn-secondary:hover {
            background-color: #4B5563;
        }
        .btn-next {
            background-color: #10B981;
            color: white;
            border-color: #10B981;
        }
        .btn-next:hover {
            background-color: #059669;
        }
        .btn-disabled {
            background-color: #D1D5DB;
            color: #6B7280;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Chosen Palette: Calm Neutrals (slate) with UI actions (blue, green, red) -->
    <!-- Application Structure Plan: "íƒ­ ê¸°ë°˜ ë·°(Tabbed View)" êµ¬ì¡°ë¡œ í†µí•©. 1) 'íƒìƒ‰ê¸°' íƒ­(ê¸°ë³¸): 'ëŒ€ì‹œë³´ë“œ'ì™€ 'ëŒ€í™”í˜• íƒìƒ‰ê¸°'ë¥¼ í¬í•¨í•˜ì—¬ ë°ì´í„° ê°œìš”ì™€ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œê³µ. 2) 'í€´ì¦ˆ' íƒ­: Python ë¡œì§ì„ ë³€í™˜í•œ 'ë‹¨ê³„ë³„ í€´ì¦ˆ' ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬ ëŠ¥ë™ì ì¸ í•™ìŠµì„ ì§€ì›. ì´ êµ¬ì¡°ëŠ” ë‘ ê°œì˜ ë‹¤ë¥¸ ì•±ì„ 'í•™ìŠµ ë„êµ¬'ë¼ëŠ” í•˜ë‚˜ì˜ ëª©ì  ì•„ë˜ ë…¼ë¦¬ì ìœ¼ë¡œ í†µí•©í•¨. -->
    <!-- Visualization & Content Choices: 1) íƒìƒ‰ê¸°: ê¸°ì¡´ì˜ ë„ë„› ì°¨íŠ¸(Chart.js)ì™€ ë™ì  ì¹´ë“œ ê·¸ë¦¬ë“œ(HTML/JS) ìœ ì§€. 2) í€´ì¦ˆ: ë‹¨ê³„ë³„ HTML í¼, ë™ì  í”„ë¡œê·¸ë ˆìŠ¤ ë°”(HTML/CSS), ê²°ê³¼ ë„ë„› ì°¨íŠ¸(Chart.js) ì‚¬ìš©. 3) ë°ì´í„°: ë‘ ê¸°ëŠ¥ì´ *í•˜ë‚˜ì˜* JS `vocabData` ê°ì²´ ë°°ì—´ì„ ê³µìœ í•˜ë„ë¡ JS ë¡œì§ì„ ìˆ˜ì •í•¨. í€´ì¦ˆ ë¡œì§ì´ íƒìƒ‰ê¸°ì˜ `{sin, plu}` ë°ì´í„°ì—ì„œ ì •ë‹µì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ë„ë¡ ë³€ê²½í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ í™•ë³´í•¨. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center my-8">
            <h1 class="text-4xl font-bold text-slate-800">ë…ì¼ì–´ í†µí•© í•™ìŠµ ì•±</h1>
            <p class="text-lg text-slate-600 mt-2">Lektion 1-3 | íƒìƒ‰ê¸° & í€´ì¦ˆ</p>
        </header>

        <!-- --- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ --- -->
        <nav class="flex justify-center max-w-md mx-auto mb-10 bg-white rounded-lg shadow-md p-1.5 space-x-2">
            <button id="navExplorer" class="nav-btn active">
                <span class="text-lg">ğŸ§­</span> íƒìƒ‰ê¸°
            </button>
            <button id="navQuiz" class="nav-btn">
                <span class="text-lg">ğŸ§ </span> í€´ì¦ˆ
            </button>
        </nav>

        <!-- --- ë·° 1: íƒìƒ‰ê¸° (ê¸°ë³¸) --- -->
        <div id="explorerView">
            <main>
                <!-- 1. ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
                <section id="dashboard" class="bg-white p-6 rounded-2xl shadow-lg mb-10">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-4">ìš”ì•½ ëŒ€ì‹œë³´ë“œ</h2>
                    <p class="text-slate-600 mb-6">
                        ì´ ë³´ê³ ì„œëŠ” Lektion 1-3ì˜ ë…ì¼ì–´ ëª…ì‚¬ 117ê°œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ê° ëª…ì‚¬ëŠ” ë‚¨ì„±(der), ì—¬ì„±(die), ì¤‘ì„±(das)ì˜ 'ì„±'ì„ ê°€ì§€ë©°, ì´ëŠ” ë¬¸ë²•ì ìœ¼ë¡œ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì•„ë˜ ì°¨íŠ¸ëŠ” ìˆ˜ì§‘ëœ ë‹¨ì–´ë“¤ì˜ ì„±ë³„ ë¶„í¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-1">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-slate-100 p-4 rounded-lg text-center">
                                    <span class="text-sm text-slate-500">ì´ ë‹¨ì–´ ìˆ˜</span>
                                    <p id="totalCount" class="text-3xl font-bold text-slate-900"></p>
                                </div>
                                <div class="bg-blue-100 p-4 rounded-lg text-center">
                                    <span class="text-sm text-blue-600">DER (ë‚¨ì„±)</span>
                                    <p id="derCount" class="text-3xl font-bold text-blue-700"></p>
                                </div>
                                <div class="bg-red-100 p-4 rounded-lg text-center">
                                    <span class="text-sm text-red-600">DIE (ì—¬ì„±)</span>
                                    <p id="dieCount" class="text-3xl font-bold text-red-700"></p>
                                </div>
                                <div class="bg-green-100 p-4 rounded-lg text-center">
                                    <span class="text-sm text-green-600">DAS (ì¤‘ì„±)</span>
                                    <p id="dasCount" class="text-3xl font-bold text-green-700"></p>
                                </div>
                            </div>
                        </div>
                        <div class="md:col-span-2 flex justify-center items-center">
                            <div class="chart-container">
                                <canvas id="genderChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 2. ëŒ€í™”í˜• íƒìƒ‰ê¸° ì„¹ì…˜ -->
                <section id="explorer" class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-4">ëŒ€í™”í˜• íƒìƒ‰ê¸°</h2>
                    <p class="text-slate-600 mb-6">
                        ì•„ë˜ì—ì„œ ì„±ë³„ í•„í„° ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜, í•œêµ­ì–´ ë˜ëŠ” ë…ì¼ì–´ë¡œ ë‹¨ì–´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì „ì²´ ëª©ë¡ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <div class="flex flex-col md:flex-row gap-4 mb-6">
                        <div class="flex-shrink-0">
                            <div id="filterButtons" class="flex space-x-2 rounded-lg p-1 bg-slate-100">
                                <button data-filter="all" class="filter-btn active w-full md:w-auto px-4 py-2 rounded-md text-sm font-medium text-slate-700 hover:bg-white transition">ì „ì²´</button>
                                <button data-filter="der" class="filter-btn w-full md:w-auto px-4 py-2 rounded-md text-sm font-medium text-blue-700 hover:bg-white transition">DER</button>
                                <button data-filter="die" class="filter-btn w-full md:w-auto px-4 py-2 rounded-md text-sm font-medium text-red-700 hover:bg-white transition">DIE</button>
                                <button data-filter="das" class="filter-btn w-full md:w-auto px-4 py-2 rounded-md text-sm font-medium text-green-700 hover:bg-white transition">DAS</button>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <input type="text" id="searchInput" placeholder="'ì‚¬ê³¼' ë˜ëŠ” 'Apfel'ë¡œ ê²€ìƒ‰..." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mb-4 text-sm text-slate-600">
                        ì´ <strong id="resultCount" class="text-slate-800"></strong>ê°œì˜ ë‹¨ì–´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.
                    </div>
                    <div id="vocabListContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- ë‹¨ì–´ ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
                    </div>
                </section>
            </main>
        </div>

        <!-- --- ë·° 2: í€´ì¦ˆ (ìˆ¨ê¹€) --- -->
        <div id="quizView" class="hidden">
            <div class="max-w-2xl w-full mx-auto">
                <main class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">

                    <!-- 1. ì‹œì‘ í™”ë©´ -->
                    <div id="startScreen">
                        <h2 class="text-2xl font-semibold text-slate-700 mb-4">í€´ì¦ˆ ì•ˆë‚´</h2>
                        <ul class="list-disc list-inside space-y-2 text-slate-600 mb-6">
                            <li>í‘œì¤€ ë‹¨ì–´: <strong>'das Auto, die Autos'</strong> í˜•ì‹ìœ¼ë¡œ ë‹¨ìˆ˜í˜•ê³¼ ë³µìˆ˜í˜•ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.</li>
                            <li>ë‹¨ìˆ˜ ì „ìš© (nur Sg.): <strong>'der Kaffee'</strong> ì²˜ëŸ¼ ë‹¨ìˆ˜í˜•ë§Œ ì…ë ¥í•˜ì„¸ìš”.</li>
                            <li>ë³µìˆ˜ ì „ìš© (nur Pl.): <strong>'die Chips'</strong> ì²˜ëŸ¼ ë³µìˆ˜í˜•ë§Œ ì…ë ¥í•˜ì„¸ìš”.</li>
                            <li>ì›€ë¼ìš°íŠ¸(Ã¤, Ã¶, Ã¼)ëŠ” 'a, o, u'ë¡œ, ì—ìŠ¤ì²´íŠ¸(ÃŸ)ëŠ” 'ss'ë¡œ ì…ë ¥í•´ë„ ì •ë‹µ ì²˜ë¦¬ë©ë‹ˆë‹¤.</li>
                            <li>ì´ 3ë²ˆì˜ ê¸°íšŒê°€ ì£¼ì–´ì§€ë©°, 2ë²ˆì§¸ ê¸°íšŒë¶€í„° íŒíŠ¸ê°€ ì œê³µë©ë‹ˆë‹¤.</li>
                            <li>ì•„ë¬´ê²ƒë„ ì…ë ¥í•˜ì§€ ì•Šê³  ì œì¶œí•˜ë©´ 'ìŠ¤í‚µ'ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ì¦‰ì‹œ ì •ë‹µì´ ê³µê°œë©ë‹ˆë‹¤.</li>
                        </ul>
                        <button id="startButton" class="btn btn-primary w-full text-lg">ì´ 117ë¬¸ì œ í€´ì¦ˆ ì‹œì‘</button>
                    </div>
        
                    <!-- 2. í€´ì¦ˆ í™”ë©´ -->
                    <div id="quizScreen" class="hidden">
                        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
                        <div class="mb-4">
                            <div class="flex justify-between text-sm font-medium text-slate-600 mb-1">
                                <span id="progressText">Q 1 / 117</span>
                                <span id="scoreText">ë§ì€ ê°œìˆ˜: 0</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-2.5">
                                <div id="progressBar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
        
                        <!-- í€´ì¦ˆ ì˜ì—­ -->
                        <div class="mt-6">
                            <label for="answerInput" class="block text-2xl font-semibold text-slate-800 mb-3" id="questionText">
                                Q) ì‚¬ê³¼
                            </label>
                            <input type="text" id="answerInput" class="w-full px-4 py-3 border border-slate-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="A) ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...">
                            
                            <!-- í”¼ë“œë°± ì˜ì—­ -->
                            <div id="feedbackContainer" class="mt-4 space-y-2"></div>
                            
                            <!-- ë²„íŠ¼ ì˜ì—­ -->
                            <div class="mt-6 flex justify-between items-center">
                                <button id="endQuizButton" class_original="btn btn-secondary" class="btn btn-secondary">í€´ì¦ˆ ì¢…ë£Œ</button>
                                <div>
                                    <button id="submitButton" class="btn btn-primary">ì œì¶œí•˜ê¸°</button>
                                    <button id="nextButton" class="btn btn-next hidden">ë‹¤ìŒ ë¬¸ì œ</button>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- 3. ê²°ê³¼ í™”ë©´ -->
                    <div id="resultsScreen" class="hidden">
                        <h2 class="text-3xl font-bold text-slate-800 text-center mb-6">í€´ì¦ˆ ê²°ê³¼</h2>
                        
                        <div class="w-full max-w-xs mx-auto mb-6">
                            <canvas id="resultChart"></canvas>
                        </div>
        
                        <div id="resultsText" class="text-center text-xl text-slate-700 space-y-2 mb-8">
                            <!-- ê²°ê³¼ í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                        </div>
                        <button id="restartButton" class="btn btn-primary w-full text-lg">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
                    </div>
                </main>
            </div>
        </div>

        <footer class="text-center text-slate-500 text-sm mt-10 pb-6">
            ë…ì¼ì–´ ëª…ì‚¬ ëª©ë¡ Lektion 1-3 ê¸°ë°˜ ëŒ€í™”í˜• ë¦¬í¬íŠ¸
        </footer>

    </div>

    <script>
        // --- 1. í†µí•© ë°ì´í„° ---
        const vocabData = [
            { kor: 'ì´ë¦„', sin: 'der Name', plu: 'die Namen', gen: 'der' },
            { kor: 'ì„±', sin: 'der Vorname', plu: 'die Vornamen', gen: 'der' },
            { kor: 'ì»¤í”¼', sin: 'der Kaffee', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ì°¨', sin: 'der Tee', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ì´ˆì½œë¦¿', sin: 'die Schokolade', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ì¹©(ê°ìì¹©)', sin: '(nur Pl.)', plu: 'die Chips', gen: 'die' },
            { kor: 'ì˜í™”ê´€', sin: 'das Kino', plu: 'die Kinos', gen: 'das' },
            { kor: 'ê·¹ì¥', sin: 'das Theater', plu: 'die Theater', gen: 'das' },
            { kor: 'ìŠ¤í¬ì¸ ', sin: 'der Sport', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ìŒì•…', sin: 'die Musik', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ì¶•êµ¬', sin: '(der) FuÃŸball', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'í…Œë‹ˆìŠ¤', sin: 'das Tennis', plu: '(nur Sg.)', gen: 'das' },
            { kor: 'íƒœì–‘', sin: 'die Sonne', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ë¹„', sin: 'der Regen', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ì „í™”ê¸°', sin: 'das Telefon', plu: 'die Telefone', gen: 'das' },
            { kor: 'ì´ë©”ì¼', sin: 'die E-Mail', plu: 'die E-Mails', gen: 'die' },
            { kor: 'ê°€ë°©', sin: 'die Tasche', plu: 'die Taschen', gen: 'die' },
            { kor: 'íœ', sin: 'der Stift', plu: 'die Stifte', gen: 'der' },
            { kor: 'íœ´ëŒ€í°', sin: 'das Handy', plu: 'die Handys', gen: 'das' },
            { kor: 'ì±…', sin: 'das Buch', plu: 'die BÃ¼cher', gen: 'das' },
            { kor: 'ì—´ì‡ ', sin: 'der SchlÃ¼ssel', plu: 'die SchlÃ¼ssel', gen: 'der' },
            { kor: 'ë³‘', sin: 'die Flasche', plu: 'die Flaschen', gen: 'die' },
            { kor: 'ì§€ê°‘', sin: 'das Portmonee', plu: 'die Portmonees', gen: 'das' },
            { kor: 'ì•ˆê²½', sin: 'die Brille', plu: 'die Brillen', gen: 'die' },
            { kor: 'ë¦½ìŠ¤í‹±', sin: 'der Lippenstift', plu: 'die Lippenstifte', gen: 'der' },
            { kor: 'ì‚¬ì§„', sin: 'das Foto', plu: 'die Fotos', gen: 'das' },
            { kor: 'ê³µì±…', sin: 'das Heft', plu: 'die Hefte', gen: 'das' },
            { kor: 'ì†ìˆ˜ê±´', sin: 'das Taschentuch', plu: 'die TaschentÃ¼cher', gen: 'das' },
            { kor: 'ë‹´ë°°', sin: 'die Zigarette', plu: 'die Zigaretten', gen: 'die' },
            { kor: 'ì‹ ë¬¸', sin: 'die Zeitung', plu: 'die Zeitungen', gen: 'die' },
            { kor: 'ë‚¨ì', sin: 'der Mann', plu: 'die MÃ¤nner', gen: 'der' },
            { kor: 'ì—¬ì', sin: 'die Frau', plu: 'die Frauen', gen: 'die' },
            { kor: 'ë‹¨ì–´', sin: 'das Wort', plu: 'die WÃ¶rter', gen: 'das' },
            { kor: 'ì‚°', sin: 'der Berg', plu: 'die Berge', gen: 'der' },
            { kor: 'ë„ì‹œ', sin: 'die Stadt', plu: 'die StÃ¤dte', gen: 'die' },
            { kor: 'ë‚˜ë¼/ì‹œê³¨', sin: 'das Land', plu: 'die LÃ¤nder', gen: 'das' },
            { kor: 'ì—¬ê°€', sin: 'die Freizeit', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'í„°í‚¤', sin: 'die TÃ¼rkei', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ë¯¸êµ­', sin: '(nur Pl.)', plu: 'die USA', gen: 'die' },
            { kor: 'ì–¸ì–´', sin: 'die Sprache', plu: 'die Sprachen', gen: 'die' },
            { kor: 'ì»´í“¨í„° ê²Œì„', sin: 'das Computerspiel', plu: 'die Computerspiele', gen: 'das' },
            { kor: 'ë ˆìŠ¤í† ë‘', sin: 'das Restaurant', plu: 'die Restaurants', gen: 'das' },
            { kor: 'ê¸°ë…í’ˆ', sin: 'das Souvenir', plu: 'die Souvenirs', gen: 'das' },
            { kor: 'ìë™ì°¨', sin: 'das Auto', plu: 'die Autos', gen: 'das' },
            { kor: 'ë§¥ì£¼', sin: 'das Bier', plu: 'die Biere', gen: 'das' },
            { kor: 'ê½ƒ', sin: 'die Blume', plu: 'die Blumen', gen: 'die' },
            { kor: 'ì†”', sin: 'die BÃ¼rste', plu: 'die BÃ¼rsten', gen: 'die' },
            { kor: 'ì¶•êµ¬ê³µ', sin: 'der FuÃŸball', plu: 'die FuÃŸbÃ¤lle', gen: 'der' },
            { kor: 'ê³° ì ¤ë¦¬', sin: 'das GummibÃ¤rchen', plu: 'die GummibÃ¤rchen', gen: 'das' },
            { kor: 'ì‹¬ì¥/ë§ˆìŒ', sin: 'das Herz', plu: 'die Herzen', gen: 'das' },
            { kor: 'ëª¨ì', sin: 'der Hut', plu: 'die HÃ¼te', gen: 'der' },
            { kor: 'ì¹¼', sin: 'das Messer', plu: 'die Messer', gen: 'das' },
            { kor: 'ì—½ì„œ', sin: 'die Postkarte', plu: 'die Postkarten', gen: 'die' },
            { kor: 'ì§‘', sin: 'das Haus', plu: 'die HÃ¤user', gen: 'das' },
            { kor: 'ì”', sin: 'die Tasse', plu: 'die Tassen', gen: 'die' },
            { kor: 'ì™€ì¸', sin: 'der Wein', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ì‹œê³„', sin: 'die Uhr', plu: 'die Uhren', gen: 'die' },
            { kor: 'ìœ ë¡œ', sin: 'der Euro', plu: 'die Euros', gen: 'der' },
            { kor: 'í”„ë‘(í™”í)', sin: 'der Franken', plu: 'die Franken', gen: 'der' },
            { kor: 'ì„¼íŠ¸', sin: 'der Cent', plu: 'die Cents', gen: 'der' },
            { kor: 'ê°€ê²©', sin: 'der Preis', plu: 'die Preise', gen: 'der' },
            { kor: 'ìŒì‹/ì‹ì‚¬', sin: 'das Essen', plu: 'die Essen', gen: 'das' },
            { kor: 'ì‹œê°„', sin: 'die Zeit', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ë¹µ', sin: 'das Brot', plu: 'die Brote', gen: 'das' },
            { kor: 'í° ë¹µ', sin: 'das WeiÃŸbrot', plu: 'die WeiÃŸbrote', gen: 'das' },
            { kor: 'ê²€ì€ ë¹µ', sin: 'das Schwarzbrot', plu: 'die Schwarzbrote', gen: 'das' },
            { kor: 'ë¡¤ë¹µ', sin: 'das BrÃ¶tchen', plu: 'die BrÃ¶tchen', gen: 'das' },
            { kor: 'í”„ë ˆì²¼', sin: 'die Brezel', plu: 'die Brezeln', gen: 'die' },
            { kor: 'ë‚¨ì ì œë¹µì‚¬', sin: 'der BÃ¤cker', plu: 'die BÃ¤cker', gen: 'der' },
            { kor: 'ì—¬ì ì œë¹µì‚¬', sin: 'die BÃ¤ckerin', plu: 'die BÃ¤ckerinnen', gen: 'die' },
            { kor: 'ë‚¨ì ê³ ê°', sin: 'der Kunde', plu: 'die Kunden', gen: 'der' },
            { kor: 'ì—¬ì ê³ ê°', sin: 'die Kundin', plu: 'die Kundinnen', gen: 'die' },
            { kor: 'ë…ì¼ì¸', sin: 'der / die Deutsche', plu: 'die Deutschen', gen: 'der/die' },
            { kor: 'í‚¬ë¡œê·¸ë¨', sin: 'das Kilogramm', plu: 'die Kilogramm', gen: 'das' },
            { kor: 'í¼ì„¼íŠ¸', sin: 'das Prozent', plu: 'die Prozente', gen: 'das' },
            { kor: 'ì•„ì¹¨ì‹ì‚¬', sin: 'das FrÃ¼hstÃ¼ck', plu: 'die FrÃ¼hstÃ¼cke', gen: 'das' },
            { kor: 'ê³„ë€', sin: 'das Ei', plu: 'die Eier', gen: 'das' },
            { kor: 'ë²„í„°', sin: 'die Butter', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'í–„', sin: 'der Schinken', plu: 'die Schinken', gen: 'der' },
            { kor: 'ì¹˜ì¦ˆ', sin: 'der KÃ¤se', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ì¼', sin: 'die Marmelade', plu: 'die Marmeladen', gen: 'die' },
            { kor: 'ê¿€', sin: 'der Honig', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ìš°ìœ ', sin: 'die Milch', plu: '(nur Sg.)', gen: 'die' },
            { kor: 'ë²„í„° ë°”ë¥¸ ë¹µ', sin: 'das Butterbrot', plu: 'die Butterbrote', gen: 'das' },
            { kor: 'ì €ë…(ì‹ì‚¬)', sin: 'das Abendbrot', plu: '(nur Sg.)', gen: 'das' },
            { kor: 'ì¡°ê°', sin: 'die Scheibe', plu: 'die Scheiben', gen: 'die' },
            { kor: 'ë°”êµ¬ë‹ˆ', sin: 'der Korb', plu: 'die KÃ¶rbe', gen: 'der' },
            { kor: 'ìƒì„ ', sin: 'der Fisch', plu: 'die Fische', gen: 'der' },
            { kor: 'ê°„ì´ ì‹ë‹¹', sin: 'der Imbissstand', plu: 'die ImbissstÃ¤nde', gen: 'der' },
            { kor: 'ìš”ë¦¬', sin: 'die Speise', plu: 'die Speisen', gen: 'die' },
            { kor: 'ìŒë£Œ', sin: 'das GetrÃ¤nk', plu: 'die GetrÃ¤nke', gen: 'das' },
            { kor: 'í–„ë²„ê±°', sin: 'der Hamburger', plu: 'die Hamburger', gen: 'der' },
            { kor: 'í”¼ì', sin: 'die Pizza', plu: 'die Pizzen', gen: 'die' },
            { kor: 'ì†Œì‹œì§€', sin: 'die Wurst', plu: 'die WÃ¼rste', gen: 'die' },
            { kor: 'êµ¬ìš´ ì†Œì‹œì§€', sin: 'die Bratwurst', plu: 'die BratwÃ¼rste', gen: 'die' },
            { kor: 'ê²¨ì', sin: 'der Senf', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ê°ìíŠ€ê¹€', sin: '(nur Pl.)', plu: 'die Pommes frites', gen: 'die' },
            { kor: 'ì¼€ì²©', sin: 'der / das Ketschup', plu: '(nur Sg.)', gen: 'der/das' },
            { kor: 'ë§ˆìš”ë„¤ì¦ˆ', sin: 'die MajonÃ¤se', plu: 'die MajonÃ¤sen', gen: 'die' },
            { kor: 'ìƒëŸ¬ë“œ', sin: 'der Salat', plu: 'die Salate', gen: 'der' },
            { kor: 'ë‹­ê³ ê¸°', sin: 'das HÃ¤hnchen', plu: 'die HÃ¤hnchen', gen: 'das' },
            { kor: 'ë¬¼', sin: 'das Wasser', plu: '(nur Sg.)', gen: 'das' },
            { kor: 'íƒ„ì‚°ìˆ˜', sin: 'das Mineralwasser', plu: '(nur Sg.)', gen: 'das' },
            { kor: 'ì£¼ìŠ¤', sin: 'der Saft', plu: 'die SÃ¤fte', gen: 'der' },
            { kor: 'ì‚¬ê³¼ ì£¼ìŠ¤', sin: 'der Apfelsaft', plu: 'die ApfelsÃ¤fte', gen: 'der' },
            { kor: 'ì½œë¼', sin: 'die Cola', plu: 'die Colas', gen: 'die' },
            { kor: 'ë ˆëª¬ì—ì´ë“œ', sin: 'die Limonade', plu: 'die Limonaden', gen: 'die' },
            { kor: 'ë°°ê³ í””', sin: 'der Hunger', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ëª©ë§ˆë¦„', sin: 'der Durst', plu: '(nur Sg.)', gen: 'der' },
            { kor: 'ë””ì €íŠ¸', sin: 'der Dessert', plu: 'die Desserts', gen: 'der' },
            { kor: 'ì¼€ì´í¬', sin: 'der Kuchen', plu: 'die Kuchen', gen: 'der' },
            { kor: 'í† ë¥´í…Œ', sin: 'die Torte', plu: 'die Torten', gen: 'die' },
            { kor: 'ì•„ì´ìŠ¤í¬ë¦¼', sin: 'das Eis', plu: '(nur Sg.)', gen: 'das' },
            { kor: 'ì‚¬ê³¼', sin: 'der Apfel', plu: 'die Ã„pfel', gen: 'der' },
            { kor: 'ë°°(ê³¼ì¼)', sin: 'die Birne', plu: 'die Birnen', gen: 'die' },
            { kor: 'ë°”ë‚˜ë‚˜', sin: 'die Banane', plu: 'die Bananen', gen: 'die' },
            { kor: 'ì‹ë£Œí’ˆ', sin: 'das Lebensmittel', plu: 'die Lebensmittel', gen: 'das' }
        ];

        // --- 2. íƒìƒ‰ê¸° ë¡œì§ ---
        let currentFilter = 'all';
        let searchTerm = '';
        
        const counts = vocabData.reduce((acc, word) => {
            if (word.gen.includes('der')) acc.der++;
            if (word.gen.includes('die')) acc.die++;
            if (word.gen.includes('das')) acc.das++;
            return acc;
        }, { der: 0, die: 0, das: 0 });

        function createGenderChart() {
            const ctx = document.getElementById('genderChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['DER (ë‚¨ì„±)', 'DIE (ì—¬ì„±)', 'DAS (ì¤‘ì„±)'],
                    datasets: [{
                        label: 'ì„±ë³„ ë¶„í¬',
                        data: [counts.der, counts.die, counts.das],
                        backgroundColor: ['#3B82F6', '#EF4444', '#10B981'],
                        borderColor: '#FFFFFF',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20 } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed !== null) { label += context.parsed + 'ê°œ'; }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function getCardClass(gender) {
            if (gender === 'der') return 'card-der';
            if (gender === 'die') return 'card-die';
            if (gender === 'das') return 'card-das';
            return 'card-multi';
        }

        function renderVocabList() {
            let filteredData = vocabData;
            if (currentFilter !== 'all') {
                filteredData = filteredData.filter(d => d.gen.includes(currentFilter));
            }
            if (searchTerm) {
                filteredData = filteredData.filter(d => 
                    d.kor.toLowerCase().includes(searchTerm) ||
                    d.sin.toLowerCase().includes(searchTerm) ||
                    d.plu.toLowerCase().includes(searchTerm)
                );
            }

            const vocabListContainer = document.getElementById('vocabListContainer');
            vocabListContainer.innerHTML = '';
            
            if (filteredData.length === 0) {
                vocabListContainer.innerHTML = `<p class="text-slate-500 col-span-full text-center">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            } else {
                filteredData.forEach(word => {
                    const cardClass = getCardClass(word.gen);
                    const card = `
                        <div class="vocab-card ${cardClass} bg-white p-4 rounded-lg shadow-sm">
                            <h3 class="text-lg font-semibold text-slate-800">${word.sin}</h3>
                            <p class="text-sm font-medium text-slate-500">${word.kor}</p>
                            <p class="text-sm text-slate-700 mt-2">
                                <span class="font-medium">ë³µìˆ˜í˜•:</span> ${word.plu}
                            </p>
                        </div>
                    `;
                    vocabListContainer.innerHTML += card;
                });
            }
            document.getElementById('resultCount').textContent = filteredData.length;
        }

        // --- 3. í€´ì¦ˆ ë¡œì§ ---

        // í€´ì¦ˆ ìƒíƒœ ë³€ìˆ˜
        let currentVocab = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let wrongAttempts = 0;
        let totalQuestions = vocabData.length;

        // í˜„ì¬ ë¬¸ì œì˜ ì •ë‹µ ì •ë³´
        let currentCorrectAnswer = "";
        let correctComparisonStrings = []; // ì •ë‹µ ë°°ì—´
        let isSgOnly = false;
        let isPlOnly = false;

        // UI ìš”ì†Œ ìºì‹± (í€´ì¦ˆ)
        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const startButton = document.getElementById('startButton');
        const endQuizButton = document.getElementById('endQuizButton');
        const restartButton = document.getElementById('restartButton');
        const submitButton = document.getElementById('submitButton');
        const nextButton = document.getElementById('nextButton');
        const progressText = document.getElementById('progressText');
        const progressBar = document.getElementById('progressBar');
        const scoreText = document.getElementById('scoreText');
        const questionText = document.getElementById('questionText');
        const answerInput = document.getElementById('answerInput');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const resultsText = document.getElementById('resultsText');
        const resultChartCtx = document.getElementById('resultChart').getContext('2d');
        let resultChartInstance = null;

        // Python normalize_umlauts
        function normalizeUmlauts(s) {
            return s.toLowerCase()
                .replace(/Ã¤/g, 'a')
                .replace(/Ã¶/g, 'o')
                .replace(/Ã¼/g, 'u')
                .replace(/ÃŸ/g, 'ss');
        }

        // Python normalize_string
        function normalizeString(s) {
            const parts = s.split(',').map(part => part.trim());
            return parts.join(', ');
        }
        
        // [ìˆ˜ì •] ìš”ì²­ 2: íŒíŠ¸ë¥¼ ìœ„í•œ ë‹¨ì–´ë§Œ ì¶”ì¶œ (ê´€ì‚¬ ì œê±°)
        function getWordOnly(s) {
            // "der / die ", "der / das ", "der ", "die ", "das " ëª¨ë‘ ì²˜ë¦¬
            return normalizeUmlauts(s).replace(/^(der|die|das|der \/ die|der \/ das)\s/i, '').trim();
        }
        
        // í€´ì¦ˆ ì‹œì‘
        function startGame() {
            startScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            currentVocab = [...vocabData].sort(() => 0.5 - Math.random());
            currentQuestionIndex = 0;
            correctCount = 0;
            totalQuestions = currentVocab.length;
            
            document.getElementById('startButton').textContent = `ì´ ${totalQuestions}ë¬¸ì œ í€´ì¦ˆ ì‹œì‘`;
            loadQuestion();
        }
        
        // ë‹¤ìŒ ë¬¸ì œ ë¡œë“œ
        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showResults(false); // í€´ì¦ˆ ì •ìƒ ì¢…ë£Œ
                return;
            }

            wrongAttempts = 0;
            const item = currentVocab[currentQuestionIndex];
            
            // --- ë°ì´í„° í†µí•© ë¡œì§ ---
            if (item.sin === '(nur Pl.)') {
                currentCorrectAnswer = item.plu + ", (nur Pl.)";
            } else {
                currentCorrectAnswer = item.sin + ", " + item.plu;
            }
            // --- --- --- ---
            
            const normCorrect = normalizeString(normalizeUmlauts(currentCorrectAnswer));
            
            isSgOnly = normCorrect.includes("(nur sg.)");
            isPlOnly = normCorrect.includes("(nur pl.)");

            // --- [ìˆ˜ì •] ìš”ì²­ 1: ì •ë‹µ ë°°ì—´ ìƒì„± ---
            correctComparisonStrings = []; 
            const correctParts = normCorrect.split(',');
            const correctSingularRaw = correctParts[0].trim();
            const correctPluralRaw = (correctParts[1] || "").trim();

            if (isSgOnly || isPlOnly) {
                // Sg./Pl. only cases
                if (correctSingularRaw.startsWith('(der) ')) {
                    correctComparisonStrings.push(correctSingularRaw.replace('(der) ', 'der ')); // "der fuÃŸball"
                    correctComparisonStrings.push(correctSingularRaw.replace('(der) ', ''));      // "fuÃŸball"
                } else if (correctSingularRaw.startsWith('der / die ')) {
                    correctComparisonStrings.push(correctSingularRaw.replace('der / die ', 'der '));
                    correctComparisonStrings.push(correctSingularRaw.replace('der / die ', 'die '));
                } else if (correctSingularRaw.startsWith('der / das ')) {
                    correctComparisonStrings.push(correctSingularRaw.replace('der / das ', 'der '));
                    correctComparisonStrings.push(correctSingularRaw.replace('der / das ', 'das '));
                } else {
                    correctComparisonStrings.push(correctSingularRaw);
                }
            } else {
                // Standard "singular, plural" cases
                const correctPlural = correctPluralRaw;
                if (correctSingularRaw.startsWith('der / die ')) {
                    correctComparisonStrings.push(`${correctSingularRaw.replace('der / die ', 'der ')}, ${correctPlural}`);
                    correctComparisonStrings.push(`${correctSingularRaw.replace('der / die ', 'die ')}, ${correctPlural}`);
                } else if (correctSingularRaw.startsWith('der / das ')) {
                    correctComparisonStrings.push(`${correctSingularRaw.replace('der / das ', 'der ')}, ${correctPlural}`);
                    correctComparisonStrings.push(`${correctSingularRaw.replace('der / das ', 'das ')}, ${correctPlural}`);
                } else {
                    // (der) ì¼€ì´ìŠ¤ëŠ” í‘œì¤€ì— ì—†ì§€ë§Œ, ì¼ë°˜ ì¼€ì´ìŠ¤ë¡œ ì²˜ë¦¬
                    correctComparisonStrings.push(`${correctSingularRaw.replace('(der) ', 'der ')}, ${correctPlural}`);
                    correctComparisonStrings.push(`${correctSingularRaw}, ${correctPlural}`); // `der Apfel, die Ã„pfel`
                }
            }
            // --- ì •ë‹µ ë°°ì—´ ìƒì„± ë ---
            
            questionText.textContent = `Q) ${item.kor}`;
            answerInput.value = "";
            feedbackContainer.innerHTML = "";
            
            updateProgress();
            
            answerInput.disabled = false;
            submitButton.classList.remove('hidden');
            submitButton.disabled = false;
            nextButton.classList.add('hidden');
            answerInput.focus();
        }
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            progressText.textContent = `Q ${currentQuestionIndex + 1} / ${totalQuestions}`;
            scoreText.textContent = `ë§ì€ ê°œìˆ˜: ${correctCount}`;
            const percentage = ((currentQuestionIndex) / totalQuestions) * 100;
            progressBar.style.width = `${percentage}%`;
        }

        // ë‹µì•ˆ í™•ì¸ (Python í€´ì¦ˆ ë¡œì§ í•µì‹¬)
        function checkAnswer() {
            const userAnswer = answerInput.value;
            
            // --- ìš”ì²­ 4: ìŠ¤í‚µ ê¸°ëŠ¥ ---
            if (userAnswer.trim() === '') {
                wrongAttempts = 3; // ì¦‰ì‹œ 3ë²ˆ í‹€ë¦° ê²ƒìœ¼ë¡œ ì²˜ë¦¬
                feedbackContainer.innerHTML = `
                    <div class="feedback feedback-incorrect">
                        ğŸ”´ ìŠ¤í‚µí–ˆìŠµë‹ˆë‹¤.<br>
                        <strong>ì •ë‹µ:</strong> ${currentCorrectAnswer}
                    </div>`;
                answerInput.disabled = true;
                submitButton.classList.add('hidden');
                nextButton.classList.remove('hidden');
                scoreText.textContent = `ë§ì€ ê°œìˆ˜: ${correctCount}`; // ì ìˆ˜íŒ ì—…ë°ì´íŠ¸
                return; // í•¨ìˆ˜ ì¢…ë£Œ
            }
            // --- ìŠ¤í‚µ ê¸°ëŠ¥ ë ---
            
            const normUser = normalizeString(normalizeUmlauts(userAnswer));

            // --- [ìˆ˜ì •] ìš”ì²­ 1: ì •ë‹µ ë°°ì—´ë¡œ í™•ì¸ ---
            if (correctComparisonStrings.includes(normUser)) {
                // ğŸŸ¢ ì •ë‹µ
                correctCount++;
                feedbackContainer.innerHTML = `<div class="feedback feedback-correct">ğŸŸ¢ ë§ì•˜ìŠµë‹ˆë‹¤!</div>`;
                answerInput.disabled = true;
                submitButton.classList.add('hidden');
                nextButton.classList.remove('hidden');
            } else {
                // ğŸ”´ ì˜¤ë‹µ
                wrongAttempts++;
                if (wrongAttempts === 3) {
                    // 3ë²ˆ í‹€ë¦¼
                    feedbackContainer.innerHTML = `
                        <div class="feedback feedback-incorrect">
                            ğŸ”´ 3ë²ˆ í‹€ë ¸ìŠµë‹ˆë‹¤.<br>
                            <strong>ì •ë‹µ:</strong> ${currentCorrectAnswer}
                        </div>`;
                    answerInput.disabled = true;
                    submitButton.classList.add('hidden');
                    nextButton.classList.remove('hidden');
                } else {
                    // 1, 2ë²ˆì§¸ í‹€ë¦¼
                    let hintHTML = "";
                    // --- [ìˆ˜ì •] ìš”ì²­ 2: ìƒì„¸ íŒíŠ¸ ë¡œì§ ---
                    if (wrongAttempts >= 1 && !isSgOnly && !isPlOnly) {
                        try {
                            const userParts = normUser.split(',');
                            // (ì •ê·œí™”ëœ) ì •ë‹µì˜ ì²« ë²ˆì§¸(í‘œì¤€) ì¼€ì´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒíŠ¸ ìƒì„±
                            // 'der / das' ì¼€ì´ìŠ¤ê°€ ì•„ë‹Œ ì¼ë°˜ ë‹¨ì–´ ('das prozent')ë¥¼ ì°¾ê¸° ìœ„í•´ filter ì‚¬ìš©
                            const correctStandard = correctComparisonStrings.find(s => !s.includes('/')) || correctComparisonStrings[0];
                            const correctParts = correctStandard.split(',');
                            
                            if (correctParts.length >= 2) {
                                const correctSingular = correctParts[0].trim();
                                const correctPlural = correctParts[1].trim();
                                const correctSingularWord = getWordOnly(correctSingular); // ê´€ì‚¬ ì—†ëŠ” ë‹¨ìˆ˜í˜•

                                if (userParts.length >= 2) {
                                    const userSingular = userParts[0].trim();
                                    const userPlural = userParts[1].trim();
                                    const userSingularWord = getWordOnly(userSingular);

                                    if (userSingular === correctSingular && userPlural !== correctPlural) {
                                        hintHTML = `<div class="feedback feedback-hint">(íŒíŠ¸: ë‹¨ìˆ˜í˜•ì€ ë§ì•˜ìŠµë‹ˆë‹¤.)</div>`;
                                    } else if (userSingular !== correctSingular && userPlural === correctPlural) {
                                        hintHTML = `<div class="feedback feedback-hint">(íŒíŠ¸: ë³µìˆ˜í˜•ì€ ë§ì•˜ìŠµë‹ˆë‹¤.)</div>`;
                                    } else if (userSingularWord === correctSingularWord && userSingular !== correctSingular) {
                                        hintHTML = `<div class="feedback feedback-hint">(íŒíŠ¸: ë‹¨ìˆ˜í˜• ë‹¨ì–´ëŠ” ë§ì•˜ì§€ë§Œ, ì„±(ê´€ì‚¬)ì´ í‹€ë ¸ìŠµë‹ˆë‹¤.)</div>`;
                                    }
                                } else if (userParts.length === 1) {
                                    const userSingular = userParts[0].trim();
                                    const userSingularWord = getWordOnly(userSingular);
                                    
                                    if (userSingular === correctSingular) {
                                        hintHTML = `<div class="feedback feedback-hint">(íŒíŠ¸: ë‹¨ìˆ˜í˜•ì€ ë§ì•˜ìŠµë‹ˆë‹¤. ë³µìˆ˜í˜•ë„ ì…ë ¥í•´ì£¼ì„¸ìš”.)</div>`;
                                    } else if (userSingularWord === correctSingularWord && userSingular !== correctSingular) {
                                         hintHTML = `<div class="feedback feedback-hint">(íŒíŠ¸: ë‹¨ìˆ˜í˜• ë‹¨ì–´ëŠ” ë§ì•˜ì§€ë§Œ, ì„±(ê´€ì‚¬)ì´ í‹€ë ¸ìŠµë‹ˆë‹¤. ë³µìˆ˜í˜•ë„ ì…ë ¥í•´ì£¼ì„¸ìš”.)</div>`;
                                    }
                                }
                            }
                        } catch (e) { } 
                    }
                    // --- ìƒì„¸ íŒíŠ¸ ë ---
                    
                    feedbackContainer.innerHTML = `
                        <div class="feedback feedback-incorrect">
                            ğŸ”´ í‹€ë ¸ìŠµë‹ˆë‹¤! (ë‚¨ì€ ê¸°íšŒ: ${3 - wrongAttempts}ë²ˆ)
                        </div>
                        ${hintHTML}`;
                    answerInput.value = "";
                    answerInput.focus();
                }
            }
            scoreText.textContent = `ë§ì€ ê°œìˆ˜: ${correctCount}`;
        }
        
        // ë‹¤ìŒ ë¬¸ì œë¡œ
        function handleNextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // ê²°ê³¼ í‘œì‹œ
        // --- [í™•ì¸] ìš”ì²­ 3: ì ìˆ˜ ë¡œì§ (ì´ë¯¸ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë¨) ---
        function showResults(wasInterrupted) {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            // 'í€´ì¦ˆ ì¢…ë£Œ' ì‹œ, í˜„ì¬ í’€ë˜ ë¬¸ì œëŠ” ì‘ì‹œí•œ ë¬¸ì œì—ì„œ ì œì™¸
            const attemptedQuestions = wasInterrupted ? currentQuestionIndex : totalQuestions;
            
            const incorrectCount = attemptedQuestions - correctCount;
            const percentage = attemptedQuestions > 0 ? (correctCount / attemptedQuestions) * 100 : 0;
            
            resultsText.innerHTML = `
                <p>ì´ ${totalQuestions} ë¬¸ì œ ì¤‘ <strong class="text-blue-600">${attemptedQuestions}</strong>ê°œë¥¼ ì‘ì‹œí–ˆìŠµë‹ˆë‹¤.</p>
                <p>ì‘ì‹œí•œ ë¬¸ì œ ì¤‘ <strong class="text-blue-600">${correctCount}</strong>ê°œë¥¼ ë§í˜”ìŠµë‹ˆë‹¤.</p>
                <p>ì •ë‹µë¥ : <strong class="text-blue-600">${percentage.toFixed(2)}%</strong></p>
            `;
            
            if (resultChartInstance) {
                resultChartInstance.destroy();
            }
            
            resultChartInstance = new Chart(resultChartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ë§ì€ ê°œìˆ˜', 'í‹€ë¦° ê°œìˆ˜ (ì‘ì‹œí•œ ë¬¸ì œ ê¸°ì¤€)'],
                    datasets: [{
                        data: [correctCount, incorrectCount > 0 ? incorrectCount : 0], // 0 ë¯¸ë§Œ ë°©ì§€
                        backgroundColor: ['#3B82F6', '#EF4444'],
                        borderColor: '#FFFFFF',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}ê°œ`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- 4. í†µí•© ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§ ---
            const navExplorer = document.getElementById('navExplorer');
            const navQuiz = document.getElementById('navQuiz');
            const explorerView = document.getElementById('explorerView');
            const quizView = document.getElementById('quizView');

            navExplorer.addEventListener('click', () => {
                explorerView.classList.remove('hidden');
                quizView.classList.add('hidden');
                navExplorer.classList.add('active');
                navQuiz.classList.remove('active');
            });

            navQuiz.addEventListener('click', () => {
                explorerView.classList.add('hidden');
                quizView.classList.remove('hidden');
                navExplorer.classList.remove('active');
                navQuiz.classList.add('active');
                
                if (quizScreen.classList.contains('hidden') && resultsScreen.classList.contains('hidden')) {
                    startScreen.classList.remove('hidden');
                }
            });
            
            // --- íƒìƒ‰ê¸° ë¦¬ìŠ¤ë„ˆ ---
            const searchInput = document.getElementById('searchInput');
            const filterButtons = document.querySelectorAll('#filterButtons .filter-btn');

            document.getElementById('totalCount').textContent = vocabData.length;
            document.getElementById('derCount').textContent = counts.der;
            document.getElementById('dieCount').textContent = counts.die;
            document.getElementById('dasCount').textContent = counts.das;

            createGenderChart();
            renderVocabList();

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentFilter = button.dataset.filter;
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    renderVocabList();
                });
            });

            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                renderVocabList();
            });

            // --- í€´ì¦ˆ ë¦¬ìŠ¤ë„ˆ ---
            startButton.addEventListener('click', startGame);
            
            submitButton.addEventListener('click', checkAnswer);
            
            // --- [ìˆ˜ì •] ìš”ì²­ 1: ì „ì—­ Enter í‚¤ ë¦¬ìŠ¤ë„ˆ (í€´ì¦ˆìš©) ---
            
            // 1. answerInputì—ì„œ Enter: 'ì œì¶œí•˜ê¸°'
            answerInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    // 'ì œì¶œí•˜ê¸°' ë²„íŠ¼ì´ ë³´ì¼ ë•Œ (ì…ë ¥ì°½ í™œì„± ìƒíƒœ)
                    if (!submitButton.classList.contains('hidden')) {
                        e.preventDefault();
                        submitButton.click();
                    }
                }
            });

            // 2. documentì—ì„œ Enter: 'ë‹¤ìŒ ë¬¸ì œ'
            document.addEventListener('keydown', (e) => {
                // í€´ì¦ˆ í™”ë©´ì´ ì•„ë‹ˆê±°ë‚˜ 'ë‹¤ìŒ' ë²„íŠ¼ì´ ì•ˆë³´ì´ë©´ ì‘ë™ ì•ˆí•¨
                if (quizScreen.classList.contains('hidden') || nextButton.classList.contains('hidden')) {
                    return;
                }
                
                if (e.key === 'Enter') {
                    // 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ì´ ë³´ì¼ ë•Œ (ì •ë‹µ/ìŠ¤í‚µ/3íšŒì˜¤ë¥˜ ì´í›„)
                    // ì´ ì‹œì ì—ëŠ” submitButtonì€ í•­ìƒ ìˆ¨ê²¨ì ¸ ìˆìŒ
                    e.preventDefault();
                    nextButton.click();
                }
            });
            
            nextButton.addEventListener('click', handleNextQuestion);
            endQuizButton.addEventListener('click', () => showResults(true)); // ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ í‘œì‹œ
            restartButton.addEventListener('click', () => {
                resultsScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            });
        });

    </script>
</body>
</html>


